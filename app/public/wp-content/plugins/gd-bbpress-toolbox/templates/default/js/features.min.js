!function(i,o,a,t){o.wp=o.wp||{},o.wp.gdbbx=o.wp.gdbbx||{},o.wp.gdbbx.helper={detect_msie:function(){var t=o.navigator.userAgent,e=t.indexOf("MSIE ");if(0<e)return parseInt(t.substring(e+5,t.indexOf(".",e)),10);if(0<t.indexOf("Trident/")){var n=t.indexOf("rv:");return parseInt(t.substring(n+3,t.indexOf(".",n)),10)}return 99},get_selection:function(){var t="";return o.getSelection?t=o.getSelection():a.getSelection?t=a.getSelection():a.selection&&(t=a.selection.createRange().text),i.trim(t.toString())},file_extension:function(t){return t.substr(t.lastIndexOf(".")+1).toLowerCase()},is_tinymce:function(){var t=0<i("#bbp_topic_content").length?"bbp_topic_content":"bbp_reply_content";return gdbbx_data.wp_editor&&!i("#"+t).is(":visible")},into_editor:function(t){var e=0<i("#bbp_topic_content").length?"bbp_topic_content":"bbp_reply_content";if(wp.gdbbx.helper.is_tinymce())t+="<br/><br/>",tinymce.get(e).execCommand("mceInsertContent",!1,t);else{var n=i("#"+e),o=n.val();""!==i.trim(o)&&(t="\n\n"+t),t+="\n\n",n.val(o+t)}},scroll_to_editor:function(){8<wp.gdbbx.helper.detect_msie()?i("html, body").animate({scrollTop:i("#new-post").offset().top},1e3):a.location.href="#new-post",i(".bbp-the-content-wrapper textarea").focus()}},o.wp.gdbbx.toolbox={bbcodes:{init:function(){i(".gdbbx-bbcode-spoiler").each(function(){var t=i(this).data("hover"),e=i(this).data("color");i(this).hover(function(){i(this).css("background",t)},function(){i(this).css("background",e)})})}},quotes:{init:function(){i(a).on("click",".gdbbx-link-quote",function(t){if(t.preventDefault(),0<i("#bbp_reply_content").length){var e=wp.gdbbx.helper.get_selection(),n=i(this).data("id"),o=wp.gdbbx.helper.is_tinymce()?"</br></br>":"\n",a=!0;if(""===e&&(a=!1,e=i("#gdbbx-quote-wrapper-"+n).html()),e=(e=(e=(e=e.replace(/&nbsp;/g," ")).replace(/<\s*p[^>]*>/g,"")).replace(/<\s*\/\s*(p|br)\s*>|<\s*br\s*>/g,o)).trim(),e=i("<div>").html(e).html(),"bbcode"===gdbbx_data.quote.method){var b="postquote"!==gdbbx_data.quote.bbcode||a?"quote":"postquote";e="postquote"===b?"["+b+" quote="+n+"]":"["+b+" quote="+n+"]"+e+"[/"+b+"]"}else{var d=gdbbx_data.quote.wrote.replace("%s",i(this).data("author"));e='<blockquote class="gdbbx-bbcode-quote">'+('<div class="gdbbx-quote-title"><a href="'+i(this).data("url")+'">'+d+":</a></div>")+e+"</blockquote>"}wp.gdbbx.helper.into_editor(e),wp.gdbbx.helper.scroll_to_editor()}})}},canned_replies:{init:function(){i(".gdbbx-canned-replies .gdbbx-canned-replies-show").click(function(t){t.preventDefault();var e=i(this).closest(".gdbbx-canned-replies");i(this).hide(),i(".gdbbx-canned-replies-hide",e).show(),i(".gdbbx-canned-replies-list",e).slideDown()}),i(".gdbbx-canned-replies .gdbbx-canned-replies-hide").click(function(t){t.preventDefault();var e=i(this).closest(".gdbbx-canned-replies");i(this).hide(),i(".gdbbx-canned-replies-show",e).show(),i(".gdbbx-canned-replies-list",e).slideUp()}),i(".gdbbx-canned-replies .gdbbx-canned-reply-insert").click(function(t){t.preventDefault();var e=i(this).closest(".gdbbx-canned-reply"),n=i(".gdbbx-canned-reply-content",e).html();if(wp.gdbbx.helper.into_editor(n),gdbbx_data.canned_replies.auto_close_on_insert){var o=i(this).closest(".gdbbx-canned-replies");i(".gdbbx-canned-replies-hide",o).click()}})}},fitvids:{init:function(){i(".bbp-topic-content, .bbp-reply-content").fitVids()}},report:{sending_report:!1,init:function(){i(".gdbbx-link-report").click(function(t){t.preventDefault(),wp.gdbbx.toolbox.report.sending_report||("form"===gdbbx_data.report.mode?wp.gdbbx.toolbox.report.form(i(this)):wp.gdbbx.toolbox.report.button(i(this)))})},button:function(t){var e=t.data("id"),n=t.data("nonce");if("confirm"!==gdbbx_data.report.mode||!1!==confirm(gdbbx_data.report.confirm)){var o={post:e,nonce:n};wp.gdbbx.toolbox.report.sending_report=!0,i.ajax({dataType:"html",type:"post",data:o,url:gdbbx_data.url+"?action=gdbbx_report_post",success:function(t){wp.gdbbx.toolbox.report.sending_report=!1,i(".gdbbx-link-report-"+o.post).replaceWith("<span>"+gdbbx_data.report.after+"</span>")}})}},form:function(t){var e=t.data("id"),n=t.data("nonce"),o=t.closest("#bbpress-forums").find(".post-"+e+" .bbp-reply-content, .post-"+e+" .bbp-topic-content");if(1===o.length){if(0===o.find(".gdbbx-report-wrapper").length){i(".gdbbx-report-wrapper").remove();var a=i(".gdbbx-report-template > div").clone().addClass("gdbbx-report-wrapper");a.find("button").data("id",e).data("nonce",n),o.append(a),a.find("input").focus(),wp.gdbbx.toolbox.report.handle(o.find(".gdbbx-report-wrapper"))}if(gdbbx_data.report.scroll){var b=0;0<i("#wpadminbar").length&&(b=i("#wpadminbar").height()),i("html, body").animate({scrollTop:o.find(".gdbbx-report-wrapper").offset().top-b},500)}}},handle:function(n){i("button.gdbbx-report-cancel",n).click(function(){i(".gdbbx-report-wrapper").remove()}),i("button.gdbbx-report-send",n).click(function(){var t=i("input",n).val();if(t.length<gdbbx_data.report.min)alert(gdbbx_data.report.alert);else{var e={report:t,post:i(this).data("id"),nonce:i(this).data("nonce")};i(".gdbbx-report-form",n).hide(),i(".gdbbx-report-sending",n).show(),wp.gdbbx.toolbox.report.sending_report=!0,i.ajax({dataType:"html",type:"post",data:e,url:gdbbx_data.url+"?action=gdbbx_report_post",success:function(t){wp.gdbbx.toolbox.report.sending_report=!1,i(".gdbbx-report-sending",n).hide(),i(".gdbbx-report-sent",n).show(),i(".gdbbx-link-report-"+e.post).replaceWith("<span>"+gdbbx_data.report.after+"</span>")}})}})}},thanks:{init:function(){i(".gdbbx-link-thanks, .gdbbx-link-unthanks").click(function(t){t.preventDefault(),wp.gdbbx.toolbox.thanks.handle(this)})},handle:function(t){var n={nonce:i(t).data("thanks-nonce"),say:i(t).data("thanks-action"),id:i(t).data("thanks-id")},o=i(t),a=o.hasClass("gdbbx-link-thanks");i.ajax({dataType:"html",type:"post",data:n,url:gdbbx_data.url+"?action=gdbbx_say_thanks",success:function(t){var e=i(t).fadeIn(600);i(".gdbbx-thanks-post-"+n.id).fadeOut(400).replaceWith(e),a?gdbbx_data.thanks.removal?o.removeClass("gdbbx-link-thanks").addClass("gdbbx-link-unthanks").data("thanks-action","unthanks").html(gdbbx_data.thanks.unthanks):o.replaceWith("<span>"+gdbbx_data.thanks.saved+"</span>"):o.removeClass("gdbbx-link-unthanks").addClass("gdbbx-link-thanks").data("thanks-action","thanks").html(gdbbx_data.thanks.thanks)}})}},scheduler:{init:function(){var t=i("#gdbbx_schedule_datetime");if(1===t.length){var e=t.val(),n={enableTime:!0,enableSeconds:!0,altInput:!0,minDate:Date.now(),minTime:Date.now(),defaultDate:0===e.length?Date.now():e,dateFormat:"Y-m-d H:i:S"};""!==gdbbx_data.flatpickr_locale&&(n.locale=gdbbx_data.flatpickr_locale),t.flatpickr(n),i(a).on("change","#gdbbx_schedule_when",function(){var t=i(this).val(),e=i(this).parent().parent().next();"future"===t?e.show():e.hide()})}}},misc:{privacy:function(){i(".gdbbx-private-reply-hidden").each(function(){i(this).hide().prev(".bbp-reply-header").hide()})}},run:function(){"undefined"!=typeof gdbbx_data&&(wp.gdbbx.toolbox.misc.privacy(),-1<gdbbx_data.load.indexOf("scheduler")&&wp.gdbbx.toolbox.scheduler.init(),-1<gdbbx_data.load.indexOf("quote")&&wp.gdbbx.toolbox.quotes.init(),-1<gdbbx_data.load.indexOf("bbcodes")&&wp.gdbbx.toolbox.bbcodes.init(),-1<gdbbx_data.load.indexOf("report")&&wp.gdbbx.toolbox.report.init(),-1<gdbbx_data.load.indexOf("thanks")&&wp.gdbbx.toolbox.thanks.init(),-1<gdbbx_data.load.indexOf("canned_replies")&&wp.gdbbx.toolbox.canned_replies.init(),-1<gdbbx_data.load.indexOf("fitvids")&&i.fn.fitVids&&wp.gdbbx.toolbox.fitvids.init())}},i(a).ready(function(){wp.gdbbx.toolbox.run()})}(jQuery,window,document);