!function(m,x,t,a){x.wp=x.wp||{},x.wp.gdbbx=x.wp.gdbbx||{},x.wp.gdbbx.attachments={is_enhanced:!0,allow_submit:!0,extensions:[],files:[],inner:1,init:function(){m("form#new-post").attr("enctype","multipart/form-data"),this.is_enhanced=gdbbx_data.attachments.validate&&9<wp.gdbbx.helper.detect_msie(),"string"==typeof gdbbx_data.attachments.allowed_extensions&&(this.extensions=gdbbx_data.attachments.allowed_extensions.split(" ")),this.actions(),this.is_enhanced?this.enhanced.run():this.basic.run()},actions:function(){m(t).on("click",".gdbbx-attachment-insert",function(t){t.preventDefault();var a='[attachment file="'+m(this).attr("href").substr(1)+'"]';wp.gdbbx.helper.into_editor(a),wp.gdbbx.helper.scroll_to_editor()}),m(t).on("click",".gdbbx-attachment-confirm",function(t){confirm(gdbbx_data.text.are_you_sure)||t.preventDefault()}),m(t).on("click",".gdbbx-attachment-add-file",function(t){t.preventDefault(),wp.gdbbx.attachments.add(this)})},count:function(){return m(".gdbbx-attachments-input").length},count_empty:function(){return m(".gdbbx-attachments-input:not(.gdbbx-attachment-added)").length},add:function(t){(!gdbbx_data.attachments.limiter||wp.gdbbx.attachments.count()<gdbbx_data.attachments.max_files)&&(!gdbbx_data.attachments.auto_new_file||gdbbx_data.attachments.auto_new_file&&0===wp.gdbbx.attachments.count_empty())&&(wp.gdbbx.attachments.is_enhanced?m(t).before(wp.gdbbx.attachments.enhanced.block()):m(t).before(wp.gdbbx.attachments.basic.block())),!gdbbx_data.attachments.auto_new_file&&gdbbx_data.attachments.limiter&&wp.gdbbx.attachments.count()===gdbbx_data.attachments.max_files&&m(t).hide()},enhanced:{run:function(){m(".gdbbx-attachments-form > div").addClass("gdbbx-validation-active"),gdbbx_data.attachments.auto_new_file&&m(".gdbbx-attachments-form").addClass("gdbbx-auto-newfile"),wp.gdbbx.attachments.enhanced.actions()},actions:function(){m(t).on("click",".gdbbx-attachment-preview",function(){m(this).closest(".gdbbx-attachments-input").find("input[type=file]").click()}),m(t).on("click",".gdbbx-attachments-input a.bbp-att-remove",function(t){t.preventDefault();var a=m(this).closest(".gdbbx-attachments-input"),e=a.data("id");delete wp.gdbbx.attachments.files[e],a.fadeOut("slow",function(){if(gdbbx_data.attachments.auto_new_file){var t=a.parent();0===m(".gdbbx-attachments-input:not(.gdbbx-attachment-added)",t).length&&m(".gdbbx-attachment-add-file",t).before(wp.gdbbx.attachments.enhanced.block())}else m(".gdbbx-attachment-add-file").show();0===wp.gdbbx.attachments.count()&&m(this).after(wp.gdbbx.attachments.enhanced.block()),m(this).remove(),wp.gdbbx.attachments.enhanced.check_submit()})}),m(t).on("change",".gdbbx-attachments-input input[type=file]",wp.gdbbx.attachments.enhanced.attach),m(t).on("click",".gdbbx-attachments-input a.bbp-att-caption",function(t){t.preventDefault(),m(this).prev().find("input").show(),m(this).hide()}),m(t).on("click",".gdbbx-attachments-input a.bbp-att-shortcode",function(t){t.preventDefault();var a='[attachment file="'+m(this).data("file")+'"]';wp.gdbbx.helper.into_editor(a),wp.gdbbx.helper.scroll_to_editor()})},attach:function(){if(this.files&&1===this.files.length){var t=m(this).closest(".gdbbx-attachments-input"),a="",e=!0,n=!0,d=!0,b=!0,i="",s=this.files[0],c=Math.round(s.size/1024),h=wp.gdbbx.helper.file_extension(s.name),l=s.name+s.size+s.lastModified+s.type;if(t.removeClass("gdbbx-attachment-invalid").addClass("gdbbx-attachment-added").data("id",wp.gdbbx.attachments.inner),i="<div>"+gdbbx_data.attachments.text.file_name+": <strong>"+s.name+"</strong></div>",i+="<div>"+gdbbx_data.attachments.text.file_size+": <strong>"+c+" kb</strong>, ",i+=gdbbx_data.attachments.text.file_type+": <strong>"+h.toUpperCase()+"</strong></div>",-1<m.inArray(h,["js","php"])&&(b=e=!1),m.each(wp.gdbbx.attachments.files,function(t,a){if(a===l)return n=e=!1}),n&&(wp.gdbbx.attachments.files[wp.gdbbx.attachments.inner]=l),gdbbx_data.attachments.limiter&&(s.size>gdbbx_data.attachments.max_size&&(d=e=!1),0<wp.gdbbx.attachments.extensions.length&&-1===m.inArray(h,wp.gdbbx.attachments.extensions)&&(b=e=!1)),e||(i+="<strong>",i+=gdbbx_data.attachments.text.file_validation,n||(i+=" "+gdbbx_data.attachments.text.file_validation_duplicate),b||(i+=" "+gdbbx_data.attachments.text.file_validation_type),d||(i+=" "+gdbbx_data.attachments.text.file_validation_size),i+="</strong><br/>",t.addClass("gdbbx-attachment-invalid")),e&&(gdbbx_data.attachments.set_caption_file&&(i+="<div><label><input name='gdbbx-attachment_caption[]' type='text' style='display: none' placeholder='"+gdbbx_data.attachments.text.file_caption_placeholder+"' /><span class='gdbbx-accessibility-show-for-sr'>"+gdbbx_data.attachments.text.file_caption_placeholder+"</span></label><a data-file='"+s.name+"' class='bbp-att-caption' href='#'>"+gdbbx_data.attachments.text.file_caption+"</a></div>"),gdbbx_data.attachments.insert_into_content&&(i+="<div><a class='bbp-att-shortcode' href='#'>"+gdbbx_data.attachments.text.file_shortcode+"</a></div>")),i+="<div><a class='bbp-att-remove' href='#'>"+gdbbx_data.attachments.text.file_remove+"</a></div>",t.find(".gdbbx-attachment-control").html(i),t.find(".gdbbx-attachment-control .bbp-att-shortcode").data("file",s.name),t.find(".gdbbx-attachment-preview .gdbbx-attached-file").remove(),x.FileReader&&/^([a-zA-Z0-9\s_\\.\-:\+])+(.jpg|.jpeg|.gif|.png|.bmp)$/.test(s.name.toLowerCase())){var o=new FileReader;o.readAsDataURL(s),o.onloadend=function(){a='<img class="gdbbx-attached-file" alt="'+s.name+'" src="'+this.result+'" />',t.find(".gdbbx-attachment-preview").prepend(a)}}else a='<p class="gdbbx-attached-file" title="'+s.name+'">.'+h.toUpperCase()+"</p>",t.find(".gdbbx-attachment-preview").prepend(a);wp.gdbbx.attachments.inner++,wp.gdbbx.attachments.add(".gdbbx-attachments-form .gdbbx-attachment-add-file"),wp.gdbbx.attachments.enhanced.check_submit()}},check_submit:function(){var t=!0;m(".gdbbx-attachments-form .gdbbx-attachments-input").each(function(){m(this).hasClass("gdbbx-attachment-invalid")&&(t=!1)}),m(".gdbbx-attachments-form").closest("form").find(".bbp-submit-wrapper button").attr("disabled",!t)},block:function(){var t='<div class="gdbbx-attachments-input gdbbx-validation-active">';return t+='<div role="button" class="gdbbx-attachment-preview"><span aria-hidden="true">'+gdbbx_data.attachments.text.select_file+"</span></div>",t+='<label><input type="file" size="40" name="gdbbx-attachment[]" />',t+='<span class="gdbbx-accessibility-show-for-sr">'+gdbbx_data.attachments.text.select_file+"</span></label>",t+='<div class="gdbbx-attachment-control"></div>',t+="</div>"}},basic:{run:function(){},actions:function(){},block:function(){var t='<div class="gdbbx-attachments-input gdbbx-validation-disabled">';return t+='<div class="gdbbx-attachment-header"><span aria-hidden="true">'+gdbbx_data.attachments.text.select_file+"</span></div>",t+='<label><input type="file" size="40" name="gdbbx-attachment[]" />',t+='<span class="gdbbx-accessibility-show-for-sr">'+gdbbx_data.attachments.text.select_file+"</span></label>",t+="</div>"}}},m(t).ready(function(){wp.gdbbx.attachments.init()})}(jQuery,window,document);